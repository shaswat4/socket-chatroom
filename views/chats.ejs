<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    Chats
  </title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link rel="stylesheet" href="stylesheets\chat.css">

</head>

<body>

  <%- include("partials/navbar") %>

    <section>
      <div class="chat-nav">
        <div class="chat-header">
          <!-- contain search and other actions -->
          <h1>Chats</h1>
          <form action="/chat/search" method="post" class="chat-search">
            <input type="text" class="chat-search-input" name="query">
          </form>
        </div>

        <div class="chat-nav-body">
          <!-- contain chat list and will dynamically reload on searching-->
          <ul>
            <h1>safgiks</h1>
          </ul>
        </div>


      </div>
    </section>
    <section>
      <div class="chat-main">
        <div class="chat-main chat-main-header"></div>
        <div class="chat-main chat-main-body"></div>
      </div>
    </section>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"></script>
    <script>
      $(document).ready(
        function () {

          function loadChatMain( value) {

            // for body header 
            $.ajax({
              url: "chat/getHeader",
              type: "POST",
              data: { user_id : value },
              success: function (data) {
                // Handle the response from the server
                console.log(data);
                $(".chat-main-header").html(data);

              },
              error: function (jqXHR, textStatus, errorThrown) {
                // Handle errors
                console.log("Error: " + textStatus + " - " + errorThrown);
              }
            });

            // for main body 
            
            
          }

          function handleClickOnItem() {
            var value = $(this).attr('value');
            loadChatMain(value);
            console.log('Value:', value);
          }


          $(".chat-search").submit(function (e) {
            e.preventDefault();
            let a = $(".chat-search-input").val();
            console.log(a);


            $.ajax({
              url: "chat/search",
              type: "POST",
              data: { query: a },
              success: function (data) {
                // Handle the response from the server
                console.log(data);
                $(".chat-nav-body").html(data);
                $('.chat-nav-items').click(handleClickOnItem);

              },
              error: function (jqXHR, textStatus, errorThrown) {
                // Handle errors
                console.log("Error: " + textStatus + " - " + errorThrown);
              }
            });

          });
        }
      )
    </script>

</body>

</html>